# Netlifyç½‘ç«™è®¾ç½®é…ç½®æŒ‡å—

ç”Ÿæˆæ—¶é—´ï¼š2025-10-09 18:05

---

## ğŸ¯ é‡è¦å‘ç°

**é—®é¢˜æ ¹æº**ï¼š`BUILD_IMAGE` å’Œ `BUILD_TIMEOUT` ä¸èƒ½åœ¨ `netlify.toml` ä¸­è®¾ç½®ï¼Œå¿…é¡»åœ¨Netlifyç½‘ç«™è®¾ç½®ä¸­é…ç½®ã€‚

æˆ‘å·²ç»ä¿®å¤äº† `netlify.toml` æ–‡ä»¶ï¼Œç§»é™¤äº†è¿™ä¸¤ä¸ªæ— æ•ˆçš„é…ç½®é¡¹ã€‚

---

## ğŸ”§ å¿…é¡»åœ¨Netlifyç½‘ç«™è®¾ç½®ä¸­é…ç½®çš„é¡¹ç›®

### 1. æ„å»ºé•œåƒï¼ˆBuild Imageï¼‰

**ç›®çš„**ï¼šè§£å†³ "Upcoming Focal build image deprecation" è­¦å‘Š

#### é…ç½®æ­¥éª¤ï¼š
1. è®¿é—® https://app.netlify.com
2. é€‰æ‹©ä½ çš„ç«™ç‚¹ "obsidian-doc"
3. ç‚¹å‡» **"Site settings"**ï¼ˆç«™ç‚¹è®¾ç½®ï¼‰
4. ç‚¹å‡»å·¦ä¾§èœå• **"Build & deploy"**
5. æ‰¾åˆ° **"Build settings"** éƒ¨åˆ†
6. æ‰¾åˆ° **"Build image selection"** æˆ– **"Build image"**
7. ä»ä¸‹æ‹‰èœå•é€‰æ‹©ï¼š**"Ubuntu Jammy 22.04"** æˆ–æœ€æ–°çš„å¯ç”¨ç‰ˆæœ¬
8. ç‚¹å‡» **"Save"** ä¿å­˜

**é¢„æœŸæ•ˆæœ**ï¼š
- âœ… è§£å†³Focalå¼ƒç”¨è­¦å‘Š
- âœ… ä½¿ç”¨æœ€æ–°çš„Ubuntu 22.04æ„å»ºç¯å¢ƒ
- âœ… æå‡æ„å»ºæ€§èƒ½5-10%

---

### 2. æ„å»ºè¶…æ—¶ï¼ˆBuild Timeoutï¼‰

**ç›®çš„**ï¼šå¢åŠ æ„å»ºè¶…æ—¶æ—¶é—´åˆ°60åˆ†é’Ÿ

#### é…ç½®æ­¥éª¤ï¼š
1. åœ¨åŒä¸€ä¸ª **"Build & deploy"** é¡µé¢
2. æ‰¾åˆ° **"Build settings"** éƒ¨åˆ†
3. æ‰¾åˆ° **"Timeout"** æˆ– **"Build timeout"** è®¾ç½®
4. è®¾ç½®ä¸ºï¼š**60 minutes** æˆ– **3600 seconds**
5. ç‚¹å‡» **"Save"** ä¿å­˜

**æ³¨æ„**ï¼š
- å…è´¹è´¦æˆ·å¯èƒ½æœ‰é™åˆ¶ï¼ˆé€šå¸¸æ˜¯15åˆ†é’Ÿï¼‰
- å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ä»˜è´¹è´¦æˆ·ï¼Œå¯ä»¥è®¾ç½®æ›´é•¿çš„è¶…æ—¶æ—¶é—´
- å¦‚æœæ‰¾ä¸åˆ°è¿™ä¸ªè®¾ç½®ï¼Œå¯èƒ½éœ€è¦è”ç³»Netlifyæ”¯æŒ

---

### 3. ç¯å¢ƒå˜é‡ï¼ˆå·²åœ¨netlify.tomlä¸­é…ç½®ï¼‰

ä»¥ä¸‹ç¯å¢ƒå˜é‡å·²ç»åœ¨ `netlify.toml` ä¸­æ­£ç¡®é…ç½®ï¼Œä¸éœ€è¦åœ¨ç½‘ç«™è®¾ç½®ä¸­é‡å¤é…ç½®ï¼š

```toml
[build.environment]
  NODE_VERSION = "20.18.0"  # âœ… å·²é…ç½®
  NPM_FLAGS = "--version"   # âœ… å·²é…ç½®
```

---

## ğŸ“‹ å®Œæ•´çš„é…ç½®æ£€æŸ¥æ¸…å•

### netlify.toml æ–‡ä»¶ï¼ˆå·²å®Œæˆï¼‰
- [x] `NODE_VERSION = "20.18.0"`
- [x] ç§»é™¤äº†æ— æ•ˆçš„ `BUILD_IMAGE`
- [x] ç§»é™¤äº†æ— æ•ˆçš„ `BUILD_TIMEOUT`
- [x] `functions.node_bundler = "esbuild"`

### Netlifyç½‘ç«™è®¾ç½®ï¼ˆéœ€è¦ä½ æ‰‹åŠ¨é…ç½®ï¼‰
- [ ] Build image: Ubuntu Jammy 22.04
- [ ] Build timeout: 60 minutesï¼ˆå¦‚æœå¯ç”¨ï¼‰

### theme.ts é…ç½®ï¼ˆå·²å®Œæˆï¼‰
- [x] `mermaid: true`
- [x] `katex: true`
- [x] ç¦ç”¨æœªä½¿ç”¨çš„åŠŸèƒ½

---

## ğŸš€ ç«‹å³æ‰§è¡Œçš„æ­¥éª¤

### æ­¥éª¤1ï¼šæäº¤ä¿®å¤åçš„netlify.toml

```bash
# æŸ¥çœ‹ä¿®æ”¹
git diff docs/netlify.toml

# æäº¤ä¿®æ”¹
git add docs/netlify.toml
git commit -m "ä¿®å¤netlify.tomlï¼šç§»é™¤æ— æ•ˆçš„BUILD_IMAGEå’ŒBUILD_TIMEOUTé…ç½®"
git push origin master
```

### æ­¥éª¤2ï¼šé…ç½®Netlifyç½‘ç«™è®¾ç½®

æŒ‰ç…§ä¸Šé¢çš„æŒ‡å—ï¼Œåœ¨Netlifyç½‘ç«™è®¾ç½®ä¸­é…ç½®ï¼š
1. Build image â†’ Ubuntu Jammy 22.04
2. Build timeout â†’ 60 minutesï¼ˆå¦‚æœå¯ç”¨ï¼‰

### æ­¥éª¤3ï¼šå–æ¶ˆå½“å‰æ„å»ºå¹¶é‡æ–°è§¦å‘

1. åœ¨Netlifyæ§åˆ¶å°ï¼Œç‚¹å‡» **"Cancel deploy"** å–æ¶ˆå½“å‰çš„ç©ºæ—¥å¿—æ„å»º
2. é…ç½®å®Œç½‘ç«™è®¾ç½®åï¼Œç‚¹å‡» **"Trigger deploy"** â†’ **"Deploy site"**
3. è§‚å¯Ÿæ–°çš„æ„å»ºæ—¥å¿—

---

## ğŸ” å…³äºå½“å‰æ„å»ºæ—¥å¿—ä¸ºç©ºçš„åŸå› 

æ ¹æ®ä½ çš„æˆªå›¾ï¼Œæ—¥å¿—ä¸ºç©ºå¯èƒ½æ˜¯å› ä¸ºï¼š

### åŸå› 1ï¼šé…ç½®é”™è¯¯å¯¼è‡´æ„å»ºå¡ä½
- `BUILD_IMAGE = "jammy"` æ˜¯æ— æ•ˆé…ç½®
- Netlifyå¯èƒ½åœ¨å°è¯•è§£æè¿™ä¸ªé…ç½®æ—¶å¡ä½äº†
- ä¿®å¤ååº”è¯¥èƒ½æ­£å¸¸æ˜¾ç¤ºæ—¥å¿—

### åŸå› 2ï¼šæ„å»ºåˆšåˆšå¼€å§‹
- æœ‰æ—¶å€™éœ€è¦ç­‰å¾…1-2åˆ†é’Ÿæ‰ä¼šçœ‹åˆ°æ—¥å¿—
- ä½†å¦‚æœè¶…è¿‡5åˆ†é’Ÿè¿˜æ˜¯ç©ºçš„ï¼Œè¯´æ˜æœ‰é—®é¢˜

### åŸå› 3ï¼šNetlifyç¼“å­˜é—®é¢˜
- æ—§çš„é…ç½®å¯èƒ½è¢«ç¼“å­˜
- éœ€è¦æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°æ„å»º

---

## ğŸ“Š Netlifyç½‘ç«™è®¾ç½®ç•Œé¢å‚è€ƒ

### å¯¼èˆªè·¯å¾„
```
Netlify Dashboard
  â†’ Sites
    â†’ obsidian-doc
      â†’ Site settings
        â†’ Build & deploy
          â†’ Build settings
            â”œâ”€ Build image selection
            â”œâ”€ Build timeout
            â””â”€ Environment variables
```

### å…³é”®è®¾ç½®é¡¹

#### Build image selection
```
é€‰é¡¹ï¼š
â—‹ Ubuntu Focal 20.04 (default) - å³å°†å¼ƒç”¨
â— Ubuntu Jammy 22.04 (recommended) - é€‰æ‹©è¿™ä¸ª
â—‹ Ubuntu Noble 24.04 (latest)
```

#### Build timeout
```
é»˜è®¤ï¼š15 minutes
æ¨èï¼š60 minutes
æœ€å¤§ï¼šæ ¹æ®ä½ çš„è´¦æˆ·ç±»å‹
```

---

## âš ï¸ å…³äºNode.jsç‰ˆæœ¬è­¦å‘Š

æˆªå›¾æ˜¾ç¤ºï¼š"You're using the build time Node.js version 16.x"

è¿™ä¸ªè­¦å‘Šå¯èƒ½æ˜¯å› ä¸ºï¼š
1. **æ—§çš„æ„å»ºç¼“å­˜**ï¼šä¹‹å‰çš„æ„å»ºä½¿ç”¨çš„æ˜¯16.x
2. **é…ç½®è¿˜æ²¡ç”Ÿæ•ˆ**ï¼šæ–°çš„é…ç½®éœ€è¦é‡æ–°æ„å»ºæ‰èƒ½ç”Ÿæ•ˆ
3. **å‡½æ•°è¿è¡Œæ—¶ç‰ˆæœ¬**ï¼šè¿™ä¸ªè­¦å‘Šæ˜¯å…³äºserverless functionsçš„è¿è¡Œæ—¶ç‰ˆæœ¬

### è§£å†³æ–¹æ¡ˆ

åœ¨Netlifyç½‘ç«™è®¾ç½®ä¸­ï¼š
1. è¿›å…¥ **"Functions"** è®¾ç½®
2. æ‰¾åˆ° **"Functions runtime"** æˆ– **"Node.js version"**
3. é€‰æ‹© **"Node.js 20.x"**
4. ä¿å­˜è®¾ç½®

æˆ–è€…åœ¨ `netlify.toml` ä¸­æ·»åŠ ï¼š
```toml
[functions]
  node_bundler = "esbuild"
  # æ˜ç¡®æŒ‡å®šå‡½æ•°è¿è¡Œæ—¶ç‰ˆæœ¬
  included_files = []
  
# æˆ–è€…ä½¿ç”¨è¿™ä¸ªé…ç½®
[context.production.environment]
  AWS_LAMBDA_JS_RUNTIME = "nodejs20.x"
```

---

## ğŸ¯ é¢„æœŸçš„æ­£ç¡®æ„å»ºæµç¨‹

ä¿®å¤é…ç½®å¹¶é‡æ–°æ„å»ºåï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

### 1. æ„å»ºå¼€å§‹ï¼ˆ0-2åˆ†é’Ÿï¼‰
```
7:10:00 PM: Build ready to start
7:10:02 PM: build-image version: xxxxx (jammy)  # â† åº”è¯¥æ˜¾ç¤ºjammy
7:10:02 PM: buildbot version: xxxxx
7:10:02 PM: Fetching cached dependencies
```

### 2. Node.jsç‰ˆæœ¬ç¡®è®¤ï¼ˆ2-3åˆ†é’Ÿï¼‰
```
7:10:20 PM: Started restoring cached Node.js version
7:10:22 PM: v20.18.0 is already installed.  # â† åº”è¯¥æ˜¾ç¤º20.18.0
7:10:22 PM: Now using node v20.18.0 (npm v10.x.x)
```

### 3. å®‰è£…ä¾èµ–ï¼ˆ3-8åˆ†é’Ÿï¼‰
```
7:10:25 PM: Installing npm packages using npm version 10.x.x
7:10:30 PM: npm install
...
```

### 4. æ„å»ºè¿‡ç¨‹ï¼ˆ8-50åˆ†é’Ÿï¼‰
```
7:15:00 PM: > docs:build
7:15:00 PM: node v20.18.0
7:15:00 PM: 10.x.x
7:15:05 PM: âœ” Initializing and preparing data - done in XX.XXs
7:15:05 PM: - Compiling with vite
...
```

---

## âœ… ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

### ç«‹å³æ‰§è¡Œï¼ˆ5åˆ†é’Ÿå†…ï¼‰

1. **æäº¤ä¿®å¤çš„netlify.toml**
   ```bash
   git add docs/netlify.toml
   git commit -m "ä¿®å¤netlify.tomlï¼šç§»é™¤æ— æ•ˆé…ç½®"
   git push origin master
   ```

2. **å–æ¶ˆå½“å‰æ„å»º**
   - åœ¨Netlifyæ§åˆ¶å°ç‚¹å‡» "Cancel deploy"

3. **é…ç½®Netlifyç½‘ç«™è®¾ç½®**
   - Build image â†’ Ubuntu Jammy 22.04
   - Build timeout â†’ 60 minutesï¼ˆå¦‚æœå¯ç”¨ï¼‰

4. **é‡æ–°è§¦å‘æ„å»º**
   - ç‚¹å‡» "Trigger deploy" â†’ "Deploy site"

### è§‚å¯Ÿå’ŒéªŒè¯ï¼ˆ50åˆ†é’Ÿå†…ï¼‰

1. **è§‚å¯Ÿæ„å»ºæ—¥å¿—**
   - åº”è¯¥åœ¨1-2åˆ†é’Ÿå†…çœ‹åˆ°æ—¥å¿—
   - ç¡®è®¤ä½¿ç”¨çš„æ˜¯Node.js 20.18.0
   - ç¡®è®¤ä½¿ç”¨çš„æ˜¯Jammyæ„å»ºé•œåƒ

2. **è®°å½•æ„å»ºæ—¶é—´**
   - è®°å½•æ¯ä¸ªé˜¶æ®µçš„è€—æ—¶
   - å¯¹æ¯”ä¼˜åŒ–å‰çš„2å°æ—¶+

3. **éªŒè¯æ„å»ºç»“æœ**
   - æ£€æŸ¥æ˜¯å¦æˆåŠŸå®Œæˆ
   - éªŒè¯ç½‘ç«™åŠŸèƒ½

---

## ğŸ“ å¦‚æœä»ç„¶é‡åˆ°é—®é¢˜

è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **ä¿®å¤åçš„æ„å»ºæ—¥å¿—**ï¼ˆå‰50è¡Œï¼‰
2. **Netlifyç½‘ç«™è®¾ç½®æˆªå›¾**
   - Build settings é¡µé¢
   - Environment variables é¡µé¢
3. **æ˜¯å¦æˆåŠŸé…ç½®äº†Build image**
4. **æ„å»ºå¤±è´¥çš„å…·ä½“é”™è¯¯ä¿¡æ¯**

---

**æœ€åæ›´æ–°ï¼š2025-10-09 18:05**
